<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Embedded System Design 2 - Project: SLSTK3400A_project2/src/main.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Embedded System Design 2 - Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('main_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">main.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>The main file for Project 2 from Embedded System Design 2 - Lab.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &quot;em_device.h&quot;</code><br />
<code>#include &quot;em_chip.h&quot;</code><br />
<code>#include &quot;em_cmu.h&quot;</code><br />
<code>#include &quot;em_gpio.h&quot;</code><br />
<code>#include &quot;<a class="el" href="pin__mapping_8h_source.html">../inc/pin_mapping.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="debugging_8h_source.html">../inc/debugging.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="delay_8h_source.html">../inc/delay.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="util_8h_source.html">../inc/util.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="interrupt_8h_source.html">../inc/interrupt.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="ADXL362_8h_source.html">../inc/ADXL362.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="DS18B20_8h_source.html">../inc/DS18B20.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="other_8h_source.html">../inc/other.h</a>&quot;</code><br />
</div>
<p><a href="main_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ae1c1201a004beb35d405fd396f53f86c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#ae1c1201a004beb35d405fd396f53f86c">WAKE_UP_PERIOD_S</a>&#160;&#160;&#160;10</td></tr>
<tr class="separator:ae1c1201a004beb35d405fd396f53f86c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:aaaac3cd1355a2985b6f312f60d5919ab"><td class="memItemLeft" align="right" valign="top">typedef enum <a class="el" href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4">mcu_states</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#aaaac3cd1355a2985b6f312f60d5919ab">MCU_State_t</a></td></tr>
<tr class="separator:aaaac3cd1355a2985b6f312f60d5919ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a68d90e0eaaa236e9664bbfc691bbd4d4"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4">mcu_states</a> { <a class="el" href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4a0cb1b2c6a7db1f1084886c98909a3f36">INIT</a>, 
<a class="el" href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4a10b4381a926db55ed18619513fb12a28">MEASURE</a>, 
<a class="el" href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4ad6137abebe4fdc59e2f0f2c84bdbe3fa">SLEEP</a>, 
<a class="el" href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4a02322edd4ce56f5e7e278a3b230062d1">WAKE_UP</a>
 }</td></tr>
<tr class="separator:a68d90e0eaaa236e9664bbfc691bbd4d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad16e16b91af17288b858dbfa6962c056"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#ad16e16b91af17288b858dbfa6962c056">checkInterrupts</a> (void)</td></tr>
<tr class="memdesc:ad16e16b91af17288b858dbfa6962c056"><td class="mdescLeft">&#160;</td><td class="mdescRight">Method to check if any interrupts are triggered.  <a href="#ad16e16b91af17288b858dbfa6962c056">More...</a><br /></td></tr>
<tr class="separator:ad16e16b91af17288b858dbfa6962c056"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a840291bc02cba5474a4cb46a9b9566fe"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main</a> (void)</td></tr>
<tr class="memdesc:a840291bc02cba5474a4cb46a9b9566fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main function.  <a href="#a840291bc02cba5474a4cb46a9b9566fe">More...</a><br /></td></tr>
<tr class="separator:a840291bc02cba5474a4cb46a9b9566fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a99665523a55922c9740992dd62c5912a"><td class="memItemLeft" align="right" valign="top">static volatile <a class="el" href="main_8c.html#aaaac3cd1355a2985b6f312f60d5919ab">MCU_State_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a99665523a55922c9740992dd62c5912a">MCUstate</a></td></tr>
<tr class="separator:a99665523a55922c9740992dd62c5912a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The main file for Project 2 from Embedded System Design 2 - Lab. </p>
<dl class="section version"><dt>Version</dt><dd>1.9 </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Brecht Van Eeckhoudt</dd></dl>
<hr/>
<h1><a class="anchor" id="Versions"></a>
Versions</h1>
<p>Please check <a href="https://github.com/Fescron/Project-LabEmbeddedDesign2/tree/master/software">https://github.com/Fescron/Project-LabEmbeddedDesign2/tree/master/software</a> to find the latest version!</p>
<ul>
<li>v1.0: Started from <a href="https://github.com/Fescron/Project-LabEmbeddedDesign1">https://github.com/Fescron/Project-LabEmbeddedDesign1</a> and added code for the DS18B20 temperature sensor and the selfmade link breakage sensor. Reformatted some of these imported methods. </li>
<li>v1.1: Removed unused files, add cable-checking method. </li>
<li>v1.2: Moved initRTCcomp method to "util.c". </li>
<li>v1.3: Stopped using deprecated function "GPIO_IntConfig". </li>
<li>v1.4: Started using get/set method for the static variable "ADXL_triggered". </li>
<li>v1.5: Reworked the code a lot (stopped disabling cmuClock_GPIO, ...). </li>
<li>v1.6: Moved all documentation above source files to this file. </li>
<li>v1.7: Updated documentation, started using a state-machine. </li>
<li>v1.8: Moved checkCable method to "other.c" and started using readVBAT method. </li>
<li>v1.9: Cleaned up documentation and TODO's.</li>
</ul>
<hr/>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000004">Todo:</a></b></dt><dd>IMPORTANT: Fix cable-checking method. Start using linked-loop mode for ADXL interrupt things.</dd></dl>
<pre class="fragment">    EXTRA THINGS: Check the section about GPIO clock and cmuClock_HFPER
                  Add WDOG functionality. (see "powertest" example)
                  Add functionality to read internal temperature
                    =&gt; Detect problems of overheating?
                  Change "mode" to release (also see Reference Manual @ 6.3.2 Debug and EM2/EM3).
                    =&gt; Also see AN0007: 2.8 Optimizing Code


    UTIL.C: Add disableClocks functionality from "emodes.c" here?

    OTHER.C: Fix cable-checking method.
             Use VCOMP?

    INTERRUPT.C: &lt;completed&gt;

    DS18B20.C: RTC sleep functionality is broken when UDELAY_Calibrate() is called.
                 =&gt; UDelay uses RTCC, Use timers instead! (timer + prescaler: every microsecond an interrupt?)
               Use internal pull-up resistor for DATA pin using DOUT argument.
                 =&gt; Not working, why? GPIO_PinModeSet(TEMP_DATA_PORT, TEMP_DATA_PIN, gpioModeInputPull, 1);
               Enter EM1 when the MCU is waiting in a delay method? (see readVBAT method in "other.c")

    DELAY.C: Enable disable/enable clock functionality?
             Check EMU_EnterEM2/3 true/false effect.

    ADXL362.C: Check if variables need to be volatile.
               Too much movement breaks interrupt functionality, register not cleared good but new movement already detected?
                 =&gt; Debugging it right now with "triggercounter", remove this variable later.
                 =&gt; Start using linked-loop mode for ADXL to fix the strange interrupt behavior?
               Enable wake-up mode: writeADXL(ADXL_REG_POWER_CTL, 0b00001000); // 5th bit
</pre><hr/>
<h1><a class="anchor" id="DEBUG"></a>
Debug mode and Energy monitor</h1>
<dl class="section warning"><dt>Warning</dt><dd>When in debug mode, the MCU will not go below EM1. This can cause some weird behavior. Exit debug mode and reset the MCU after flashing it. The energy profiler can also be used to program the MCU but it's also necessary to reset the MCU after flashing it.</dd></dl>
<hr/>
<h1><a class="anchor" id="SETTINGS"></a>
Settings using definitions in dbprint and delay functionality</h1>
<p>In the file <code><a class="el" href="debugging_8h.html" title="Enable or disable printing to UART. ">debugging.h</a></code> dbprint functionality can be enabled/disabled with the definition <code>#define DEBUGGING</code>. If this line is commented, all dbprint statements are disabled throughout the source code because they're all surrounded with <code>#ifdef DEBUGGING ... #endif</code> checks.</p>
<p>In the file <code><a class="el" href="delay_8h.html" title="Delay functionality. ">delay.h</a></code> one can <b>choose between SysTicks or RTC sleep functionality</b> for delays. This can be selected with the definition <code>#define SYSTICKDELAY</code>. If this line is commented, the RTC compare sleep functionality is used. Otherwise, delays are generated using SysTicks.</p>
<p>In the file <code><a class="el" href="delay_8h.html" title="Delay functionality. ">delay.h</a></code> one can also <b>choose between the use of the ultra low-frequency RC oscillator (ULFRCO) or the low-frequency crystal oscillator (LFXO)</b> when being in a delay or sleeping. If the ULFRCO is selected, the MCU sleeps in EM3 and if the LFXO is selected the MCU sleeps in EM2. This can be selected with the definition <code>#define ULFRCO</code>. If this line is commented, the LFXO is used as the clock source. Otherwise, the ULFRCO is used.</p>
<dl class="section note"><dt>Note</dt><dd>Check the next section for more info about this.</dd></dl>
<hr/>
<h1><a class="anchor" id="CLOCKS1"></a>
Crystals and RC oscillators (delay.c)</h1>
<p>Normally using an external oscillator/crystal uses less energy than the internal one. This external oscillator/crystal can however be omitted if the design goal is to reduce the BOM count as much as possible.</p>
<p>In the delay logic, it's possible to select the use of the ultra low-frequency RC oscillator (ULFRCO) or the low-frequency crystal oscillator (LFXO) when being in a delay or sleeping. If the ULFRCO is selected, the MCU sleeps in EM3 and if the LFXO is selected the MCU sleeps in EM2.</p>
<dl class="section warning"><dt>Warning</dt><dd>After testing it was noted that the ULFRCO uses less power than the LFXO but was less precise for the wake-up times. Take not of this when selecting the necessary logic!</dd></dl>
<p>For the development of the code for the RN2483 shield from DRAMCO, it's possible they chose to use the LFXO instead of the ULFRCO in sleep because the crystal was more stable for high baudrate communication using the LEUART peripheral.</p>
<dl class="section note"><dt>Note</dt><dd>For low-power development it's advised to consistently enable peripherals and oscillators/clocks when needed and disable them afterwards. For some methods it can be useful to provide a boolean argument so that in the case of sending more bytes the clock can be disabled only after sending the latest one. Perhaps this can be used in combination with static variables in the method so they keep their value between calls and recursion can be used.</dd></dl>
<hr/>
<h1><a class="anchor" id="Initializations"></a>
Initializations</h1>
<dl class="section warning"><dt>Warning</dt><dd>Initializations for the methods <code><a class="el" href="util_8c.html#ae4f2649524bfb723543f0dc939cd0ddd" title="Enable or disable the LED. ">led(bool enabled)</a>;</code>, <code><a class="el" href="delay_8c.html#adb46f4276f5ddf111153701858f85df6" title="Wait for a certain amount of milliseconds. ">delay(uint32_t msDelay)</a>;</code> and <code><a class="el" href="delay_8c.html#aae86f940455b5957441f4331cdc0828d" title="Sleep for a certain amount of seconds in EM2/3. ">sleep(uint32_t sSleep)</a>;</code> happen automatically. This is why their first call sometimes takes longer to finish than later ones.</dd></dl>
<hr/>
<h1><a class="anchor" id="cmuClock_GPIO"></a>
cmuClock_GPIO</h1>
<p>At one point in the development phase the clock to the GPIO peripheral was always enabled when necessary and disabled afterwards. Because the GPIO clock needs to be enabled for almost everything, even during EM2 so the MCU can react (and not only log) pin interrupts, this behavior was later scrapped.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000005">Todo:</a></b></dt><dd>Also talk about cmuClock_HFPER?</dd></dl>
<hr/>
<h1><a class="anchor" id="RTCC"></a>
RTCC (RTC calendar)</h1>
<p>At another point in the development phase there was looked into using the RTCC (RTC calendar) to wake up the MCU every hour. This peripheral can run down to EM4H when using LFRCO, LFXO or ULFRCO. Unfortunately the Happy Gecko doesn't have this functionality so it can't be implemented in this case.</p>
<hr/>
<h1><a class="anchor" id="EM"></a>
Energy modes (EM1 and EM3)</h1>
<p>At one point a method was developed to go in EM1 when waiting in a delay. This however didn't seem to work as intended and EM2 would also be fine. Because of this, development for this EM1 delay method was halted. EM1 is sometimes used when waiting on bits to be set.</p>
<p>When the MCU is in EM1, the clock to the CPU is disabled. All peripherals, as well as RAM and flash, are available.</p>
<p>In EM3, high and low frequency clocks are disabled. No oscillator (except the ULFRCO) is running. Furthermore, all unwanted oscillators are disabled in EM3. This means that nothing needs to be manually disabled before the statement <code>EMU_EnterEM3(true);</code>.</p>
<p>The following modules/functions are are generally still available in EM3: </p><ul>
<li>I2C address check </li>
<li>Watchdog </li>
<li>Asynchronous pin interrupt </li>
<li>Analog comparator (ACMP) </li>
<li>Voltage comparator (VCMP) </li>
</ul>

<p class="definition">Definition in file <a class="el" href="main_8c_source.html">main.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ae1c1201a004beb35d405fd396f53f86c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae1c1201a004beb35d405fd396f53f86c">&#9670;&nbsp;</a></span>WAKE_UP_PERIOD_S</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WAKE_UP_PERIOD_S&#160;&#160;&#160;10</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Time between each wake-up in seconds </p>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00195">195</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="aaaac3cd1355a2985b6f312f60d5919ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaaac3cd1355a2985b6f312f60d5919ab">&#9670;&nbsp;</a></span>MCU_State_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef enum <a class="el" href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4">mcu_states</a>  <a class="el" href="main_8c.html#aaaac3cd1355a2985b6f312f60d5919ab">MCU_State_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Enum type for the state machine </p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="a68d90e0eaaa236e9664bbfc691bbd4d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68d90e0eaaa236e9664bbfc691bbd4d4">&#9670;&nbsp;</a></span>mcu_states</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4">mcu_states</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Enum type for the state machine </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a68d90e0eaaa236e9664bbfc691bbd4d4a0cb1b2c6a7db1f1084886c98909a3f36"></a>INIT&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a68d90e0eaaa236e9664bbfc691bbd4d4a10b4381a926db55ed18619513fb12a28"></a>MEASURE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a68d90e0eaaa236e9664bbfc691bbd4d4ad6137abebe4fdc59e2f0f2c84bdbe3fa"></a>SLEEP&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a68d90e0eaaa236e9664bbfc691bbd4d4a02322edd4ce56f5e7e278a3b230062d1"></a>WAKE_UP&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00200">200</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                       {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <a class="code" href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4a0cb1b2c6a7db1f1084886c98909a3f36">INIT</a>,</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <a class="code" href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4a10b4381a926db55ed18619513fb12a28">MEASURE</a>,</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <a class="code" href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4ad6137abebe4fdc59e2f0f2c84bdbe3fa">SLEEP</a>,</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <a class="code" href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4a02322edd4ce56f5e7e278a3b230062d1">WAKE_UP</a></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;} <a class="code" href="main_8c.html#aaaac3cd1355a2985b6f312f60d5919ab">MCU_State_t</a>;</div><div class="ttc" id="main_8c_html_a68d90e0eaaa236e9664bbfc691bbd4d4a10b4381a926db55ed18619513fb12a28"><div class="ttname"><a href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4a10b4381a926db55ed18619513fb12a28">MEASURE</a></div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00202">main.c:202</a></div></div>
<div class="ttc" id="main_8c_html_a68d90e0eaaa236e9664bbfc691bbd4d4ad6137abebe4fdc59e2f0f2c84bdbe3fa"><div class="ttname"><a href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4ad6137abebe4fdc59e2f0f2c84bdbe3fa">SLEEP</a></div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00203">main.c:203</a></div></div>
<div class="ttc" id="main_8c_html_a68d90e0eaaa236e9664bbfc691bbd4d4a02322edd4ce56f5e7e278a3b230062d1"><div class="ttname"><a href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4a02322edd4ce56f5e7e278a3b230062d1">WAKE_UP</a></div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00204">main.c:204</a></div></div>
<div class="ttc" id="main_8c_html_aaaac3cd1355a2985b6f312f60d5919ab"><div class="ttname"><a href="main_8c.html#aaaac3cd1355a2985b6f312f60d5919ab">MCU_State_t</a></div><div class="ttdeci">enum mcu_states MCU_State_t</div></div>
<div class="ttc" id="main_8c_html_a68d90e0eaaa236e9664bbfc691bbd4d4a0cb1b2c6a7db1f1084886c98909a3f36"><div class="ttname"><a href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4a0cb1b2c6a7db1f1084886c98909a3f36">INIT</a></div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00201">main.c:201</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ad16e16b91af17288b858dbfa6962c056"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad16e16b91af17288b858dbfa6962c056">&#9670;&nbsp;</a></span>checkInterrupts()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void checkInterrupts </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Method to check if any interrupts are triggered. </p>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00217">217</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;{</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="interrupt_8h.html#ab21b930d7d49ab29917b54408373414a">BTN_getTriggered</a>(0))</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    {</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="preprocessor">#ifdef DEBUGGING </span><span class="comment">/* DEBUGGING */</span><span class="preprocessor"></span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        dbprintln_color(<span class="stringliteral">&quot;PB0 pushed!&quot;</span>, 4);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* DEBUGGING */</span><span class="preprocessor"></span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <a class="code" href="interrupt_8h.html#abb85f76e16c270396851fad940339a4b">BTN_setTriggered</a>(0, <span class="keyword">false</span>); <span class="comment">/* Clear static variable */</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    }</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="interrupt_8h.html#ab21b930d7d49ab29917b54408373414a">BTN_getTriggered</a>(1))</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    {</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="preprocessor">#ifdef DEBUGGING </span><span class="comment">/* DEBUGGING */</span><span class="preprocessor"></span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        dbprintln_color(<span class="stringliteral">&quot;PB1 pushed!&quot;</span>, 4);</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* DEBUGGING */</span><span class="preprocessor"></span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <a class="code" href="interrupt_8h.html#abb85f76e16c270396851fad940339a4b">BTN_setTriggered</a>(1, <span class="keyword">false</span>); <span class="comment">/* Clear static variable */</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    }</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="comment">/* Read status register to acknowledge interrupt</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">     * (can be disabled by changing LINK/LOOP mode in ADXL_REG_ACT_INACT_CTL)</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">     * TODO this can perhaps fix the bug where too much movement breaks interrupt wake-up ... */</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ADXL362_8h.html#a0a502d06bb2873e643ce69873622ed04">ADXL_getTriggered</a>())</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    {</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="preprocessor">#ifdef DEBUGGING </span><span class="comment">/* DEBUGGING */</span><span class="preprocessor"></span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        dbprintln_color(<span class="stringliteral">&quot;INT-PD7 triggered!&quot;</span>, 4);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* DEBUGGING */</span><span class="preprocessor"></span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <a class="code" href="ADXL362_8h.html#a76886733862257ff800cd5924e0c3e76">ADXL_enableSPI</a>(<span class="keyword">true</span>);  <span class="comment">/* Enable SPI functionality */</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <a class="code" href="ADXL362_8h.html#a40573570150c448c0504097f13b96cea">ADXL_ackInterrupt</a>();   <span class="comment">/* Acknowledge ADXL interrupt */</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <a class="code" href="ADXL362_8h.html#a76886733862257ff800cd5924e0c3e76">ADXL_enableSPI</a>(<span class="keyword">false</span>); <span class="comment">/* Disable SPI functionality */</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    }</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;}</div><div class="ttc" id="ADXL362_8h_html_a0a502d06bb2873e643ce69873622ed04"><div class="ttname"><a href="ADXL362_8h.html#a0a502d06bb2873e643ce69873622ed04">ADXL_getTriggered</a></div><div class="ttdeci">bool ADXL_getTriggered(void)</div><div class="ttdoc">Getter for the ADXL_triggered static variable. </div><div class="ttdef"><b>Definition:</b> <a href="ADXL362_8c_source.html#l00126">ADXL362.c:126</a></div></div>
<div class="ttc" id="interrupt_8h_html_abb85f76e16c270396851fad940339a4b"><div class="ttname"><a href="interrupt_8h.html#abb85f76e16c270396851fad940339a4b">BTN_setTriggered</a></div><div class="ttdeci">void BTN_setTriggered(uint8_t number, bool value)</div><div class="ttdoc">Setter for the PB0_triggered and PB1_triggered static variable. </div><div class="ttdef"><b>Definition:</b> <a href="interrupt_8c_source.html#l00143">interrupt.c:143</a></div></div>
<div class="ttc" id="interrupt_8h_html_ab21b930d7d49ab29917b54408373414a"><div class="ttname"><a href="interrupt_8h.html#ab21b930d7d49ab29917b54408373414a">BTN_getTriggered</a></div><div class="ttdeci">bool BTN_getTriggered(uint8_t number)</div><div class="ttdoc">Getter for the PB0_triggered and PB1_triggered static variables. </div><div class="ttdef"><b>Definition:</b> <a href="interrupt_8c_source.html#l00114">interrupt.c:114</a></div></div>
<div class="ttc" id="ADXL362_8h_html_a76886733862257ff800cd5924e0c3e76"><div class="ttname"><a href="ADXL362_8h.html#a76886733862257ff800cd5924e0c3e76">ADXL_enableSPI</a></div><div class="ttdeci">void ADXL_enableSPI(bool enabled)</div><div class="ttdoc">Enable or disable the SPI pins and USART0/1 clock and peripheral to the accelerometer. </div><div class="ttdef"><b>Definition:</b> <a href="ADXL362_8c_source.html#l00155">ADXL362.c:155</a></div></div>
<div class="ttc" id="ADXL362_8h_html_a40573570150c448c0504097f13b96cea"><div class="ttname"><a href="ADXL362_8h.html#a40573570150c448c0504097f13b96cea">ADXL_ackInterrupt</a></div><div class="ttdeci">void ADXL_ackInterrupt(void)</div><div class="ttdoc">Acknowledge the interrupt from the accelerometer. </div><div class="ttdef"><b>Definition:</b> <a href="ADXL362_8c_source.html#l00140">ADXL362.c:140</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a840291bc02cba5474a4cb46a9b9566fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a840291bc02cba5474a4cb46a9b9566fe">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main function. </p>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00260">260</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;{</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="comment">/* TODO: Remove these variables later? */</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordtype">float</span> temperature = 0;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordtype">bool</span> notBroken = <span class="keyword">false</span>;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    uint32_t voltage = 0;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordflow">while</span>(1)</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    {</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <span class="keywordflow">switch</span>(<a class="code" href="main_8c.html#a99665523a55922c9740992dd62c5912a">MCUstate</a>)</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        {</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4a0cb1b2c6a7db1f1084886c98909a3f36">INIT</a>:</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            {</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                CHIP_Init(); <span class="comment">/* Initialize chip */</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                <span class="comment">//UDELAY_Calibrate(); /* TODO: maybe remove this later? TIMERS! */</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="preprocessor">#ifdef DEBUGGING </span><span class="comment">/* DEBUGGING */</span><span class="preprocessor"></span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                dbprint_INIT(USART1, 4, <span class="keyword">true</span>, <span class="keyword">false</span>); <span class="comment">/* VCOM */</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                <span class="comment">//dbprint_INIT(USART1, 0, false, false); /* US1_TX = PC0 */</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                <span class="comment">//dbprint_INIT(DBG_UART, DBG_UART_LOC, false, false);</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* DEBUGGING */</span><span class="preprocessor"></span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                <a class="code" href="util_8h.html#ae4f2649524bfb723543f0dc939cd0ddd">led</a>(<span class="keyword">true</span>); <span class="comment">/* Enable (and initialize) LED */</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                <a class="code" href="interrupt_8h.html#a7e35708d61d26e9fe559a5545cdad810">initGPIOwakeup</a>(); <span class="comment">/* Initialize GPIO wake-up */</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                <a class="code" href="other_8h.html#a843e3c23f8c14dfd5fd52aeacd70f291">initVBAT</a>(); <span class="comment">/* Initialize ADC to read battery voltage */</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                <span class="comment">/* Initialize accelerometer */</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                <span class="keywordflow">if</span> (<span class="keyword">true</span>)</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                    <a class="code" href="ADXL362_8h.html#a751aabb29c6d1d22a54443e94873dbe5">initADXL</a>();</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                    <span class="comment">/* Set the measurement range (0 - 1 - 2) */</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                    <a class="code" href="ADXL362_8h.html#a845daa80087540676884efe073972ed0">ADXL_configRange</a>(1); <span class="comment">/* 0 = +-2g -- 1 = +-4g -- 3 = +-8g */</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                    <span class="comment">/* Configure ODR (0 - 1 - 2 - 3 - 4 - 5) */</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                    <a class="code" href="ADXL362_8h.html#a11979b369ae160fe0f1b703766ad30de">ADXL_configODR</a>(0); <span class="comment">/* 0 = 12.5 Hz -- 3 = 100 Hz (reset default) */</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                    <span class="comment">/* Read and display values forever */</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                    <span class="comment">//ADXL_readValues();</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                    <span class="comment">/* Configure activity detection on INT1 */</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                    <a class="code" href="ADXL362_8h.html#a94fe350d1a382c347c5aec424d573af8">ADXL_configActivity</a>(3); <span class="comment">/* [g] */</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                    <span class="comment">/* Enable measurements */</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                    <a class="code" href="ADXL362_8h.html#a3a32a4cf4d2f84835d7bd4a640fa66d6">ADXL_enableMeasure</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                    <a class="code" href="delay_8h.html#adb46f4276f5ddf111153701858f85df6">delay</a>(100); <span class="comment">/* TODO: Weird INT behavour, try to fix this with link-looped mode! */</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                    <span class="comment">/* ADXL gives interrupt, capture this */</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                    <a class="code" href="ADXL362_8h.html#a40573570150c448c0504097f13b96cea">ADXL_ackInterrupt</a>(); <span class="comment">/* Acknowledge ADXL interrupt */</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                    <span class="comment">/* Disable SPI after the initializations */</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                    <a class="code" href="ADXL362_8h.html#a76886733862257ff800cd5924e0c3e76">ADXL_enableSPI</a>(<span class="keyword">false</span>);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                    <span class="comment">/* ADXL give interrupt, capture this */</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                    <a class="code" href="ADXL362_8h.html#a4ec684aa4bd58a9a39b8a9187a41fd6a">ADXL_setTriggered</a>(<span class="keyword">false</span>); <span class="comment">/* Reset variable again */</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                }</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                <a class="code" href="main_8c.html#a99665523a55922c9740992dd62c5912a">MCUstate</a> = <a class="code" href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4a10b4381a926db55ed18619513fb12a28">MEASURE</a>;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            } <span class="keywordflow">break</span>;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4a10b4381a926db55ed18619513fb12a28">MEASURE</a>:</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            {</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                <a class="code" href="util_8h.html#ae4f2649524bfb723543f0dc939cd0ddd">led</a>(<span class="keyword">true</span>); <span class="comment">/* Enable LED */</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                <a class="code" href="delay_8h.html#adb46f4276f5ddf111153701858f85df6">delay</a>(500);</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                <a class="code" href="main_8c.html#ad16e16b91af17288b858dbfa6962c056">checkInterrupts</a>();</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                <span class="comment">/* TODO: not working atm due to UDelay_calibrate being disabled */</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                temperature = <a class="code" href="DS18B20_8h.html#a4067fdb03437426a25af1f210622217b">readTempDS18B20</a>(); <span class="comment">/* A measurement takes about 550 ms */</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="preprocessor">#ifdef DEBUGGING </span><span class="comment">/* DEBUGGING */</span><span class="preprocessor"></span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                dbinfoInt(<span class="stringliteral">&quot;Temperature: &quot;</span>, temperature, <span class="stringliteral">&quot;°C&quot;</span>);</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* DEBUGGING */</span><span class="preprocessor"></span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                notBroken = <a class="code" href="other_8h.html#af3994387a62811a825f973e1a09a533a">checkCable</a>(); <span class="comment">/* Check the cable */</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                voltage = <a class="code" href="other_8h.html#a1f7889b33f2e6fb32888539eb809d7c9">readVBAT</a>(); <span class="comment">/* Read battery voltage */</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="preprocessor">#ifdef DEBUGGING </span><span class="comment">/* DEBUGGING */</span><span class="preprocessor"></span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                dbinfoInt(<span class="stringliteral">&quot;Battery voltage: &quot;</span>, voltage, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* DEBUGGING */</span><span class="preprocessor"></span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                <a class="code" href="util_8h.html#ae4f2649524bfb723543f0dc939cd0ddd">led</a>(<span class="keyword">false</span>); <span class="comment">/* Disable LED */</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                <a class="code" href="main_8c.html#a99665523a55922c9740992dd62c5912a">MCUstate</a> = <a class="code" href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4ad6137abebe4fdc59e2f0f2c84bdbe3fa">SLEEP</a>;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            } <span class="keywordflow">break</span>;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4ad6137abebe4fdc59e2f0f2c84bdbe3fa">SLEEP</a>:</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            {</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                <a class="code" href="delay_8h.html#aae86f940455b5957441f4331cdc0828d">sleep</a>(<a class="code" href="main_8c.html#ae1c1201a004beb35d405fd396f53f86c">WAKE_UP_PERIOD_S</a>); <span class="comment">/* Go to sleep for xx seconds */</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                <a class="code" href="main_8c.html#a99665523a55922c9740992dd62c5912a">MCUstate</a> = <a class="code" href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4a02322edd4ce56f5e7e278a3b230062d1">WAKE_UP</a>;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            } <span class="keywordflow">break</span>;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4a02322edd4ce56f5e7e278a3b230062d1">WAKE_UP</a>:</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            {</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                <span class="comment">/* Unused */</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                <a class="code" href="main_8c.html#a99665523a55922c9740992dd62c5912a">MCUstate</a> = <a class="code" href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4a10b4381a926db55ed18619513fb12a28">MEASURE</a>;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            } <span class="keywordflow">break</span>;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            {</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                <a class="code" href="util_8h.html#ab212081592c908bf57b591e3c6e7483d">error</a>(0);</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            } <span class="keywordflow">break</span>;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        }</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    }</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;}</div><div class="ttc" id="other_8h_html_a1f7889b33f2e6fb32888539eb809d7c9"><div class="ttname"><a href="other_8h.html#a1f7889b33f2e6fb32888539eb809d7c9">readVBAT</a></div><div class="ttdeci">uint32_t readVBAT(void)</div><div class="ttdoc">Method to read the battery voltage. </div><div class="ttdef"><b>Definition:</b> <a href="other_8c_source.html#l00086">other.c:86</a></div></div>
<div class="ttc" id="main_8c_html_ad16e16b91af17288b858dbfa6962c056"><div class="ttname"><a href="main_8c.html#ad16e16b91af17288b858dbfa6962c056">checkInterrupts</a></div><div class="ttdeci">void checkInterrupts(void)</div><div class="ttdoc">Method to check if any interrupts are triggered. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00217">main.c:217</a></div></div>
<div class="ttc" id="main_8c_html_a68d90e0eaaa236e9664bbfc691bbd4d4a10b4381a926db55ed18619513fb12a28"><div class="ttname"><a href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4a10b4381a926db55ed18619513fb12a28">MEASURE</a></div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00202">main.c:202</a></div></div>
<div class="ttc" id="main_8c_html_a99665523a55922c9740992dd62c5912a"><div class="ttname"><a href="main_8c.html#a99665523a55922c9740992dd62c5912a">MCUstate</a></div><div class="ttdeci">static volatile MCU_State_t MCUstate</div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00210">main.c:210</a></div></div>
<div class="ttc" id="ADXL362_8h_html_a845daa80087540676884efe073972ed0"><div class="ttname"><a href="ADXL362_8h.html#a845daa80087540676884efe073972ed0">ADXL_configRange</a></div><div class="ttdeci">void ADXL_configRange(uint8_t givenRange)</div><div class="ttdoc">Configure the measurement range and store the selected one in a global variable for later (internal) ...</div><div class="ttdef"><b>Definition:</b> <a href="ADXL362_8c_source.html#l00261">ADXL362.c:261</a></div></div>
<div class="ttc" id="other_8h_html_af3994387a62811a825f973e1a09a533a"><div class="ttname"><a href="other_8h.html#af3994387a62811a825f973e1a09a533a">checkCable</a></div><div class="ttdeci">bool checkCable(void)</div><div class="ttdoc">Method to check if the wire is broken. </div><div class="ttdef"><b>Definition:</b> <a href="other_8c_source.html#l00124">other.c:124</a></div></div>
<div class="ttc" id="ADXL362_8h_html_a3a32a4cf4d2f84835d7bd4a640fa66d6"><div class="ttname"><a href="ADXL362_8h.html#a3a32a4cf4d2f84835d7bd4a640fa66d6">ADXL_enableMeasure</a></div><div class="ttdeci">void ADXL_enableMeasure(bool enabled)</div><div class="ttdoc">Enable or disable measurement mode. </div><div class="ttdef"><b>Definition:</b> <a href="ADXL362_8c_source.html#l00214">ADXL362.c:214</a></div></div>
<div class="ttc" id="ADXL362_8h_html_a4ec684aa4bd58a9a39b8a9187a41fd6a"><div class="ttname"><a href="ADXL362_8h.html#a4ec684aa4bd58a9a39b8a9187a41fd6a">ADXL_setTriggered</a></div><div class="ttdeci">void ADXL_setTriggered(bool triggered)</div><div class="ttdoc">Setter for the ADXL_triggered static variable. </div><div class="ttdef"><b>Definition:</b> <a href="ADXL362_8c_source.html#l00112">ADXL362.c:112</a></div></div>
<div class="ttc" id="ADXL362_8h_html_a751aabb29c6d1d22a54443e94873dbe5"><div class="ttname"><a href="ADXL362_8h.html#a751aabb29c6d1d22a54443e94873dbe5">initADXL</a></div><div class="ttdeci">void initADXL(void)</div><div class="ttdoc">Initialize the accelerometer. </div><div class="ttdef"><b>Definition:</b> <a href="ADXL362_8c_source.html#l00073">ADXL362.c:73</a></div></div>
<div class="ttc" id="ADXL362_8h_html_a76886733862257ff800cd5924e0c3e76"><div class="ttname"><a href="ADXL362_8h.html#a76886733862257ff800cd5924e0c3e76">ADXL_enableSPI</a></div><div class="ttdeci">void ADXL_enableSPI(bool enabled)</div><div class="ttdoc">Enable or disable the SPI pins and USART0/1 clock and peripheral to the accelerometer. </div><div class="ttdef"><b>Definition:</b> <a href="ADXL362_8c_source.html#l00155">ADXL362.c:155</a></div></div>
<div class="ttc" id="main_8c_html_a68d90e0eaaa236e9664bbfc691bbd4d4ad6137abebe4fdc59e2f0f2c84bdbe3fa"><div class="ttname"><a href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4ad6137abebe4fdc59e2f0f2c84bdbe3fa">SLEEP</a></div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00203">main.c:203</a></div></div>
<div class="ttc" id="util_8h_html_ab212081592c908bf57b591e3c6e7483d"><div class="ttname"><a href="util_8h.html#ab212081592c908bf57b591e3c6e7483d">error</a></div><div class="ttdeci">void error(uint8_t number)</div><div class="ttdoc">Error method. </div><div class="ttdef"><b>Definition:</b> <a href="util_8c_source.html#l00083">util.c:83</a></div></div>
<div class="ttc" id="main_8c_html_a68d90e0eaaa236e9664bbfc691bbd4d4a02322edd4ce56f5e7e278a3b230062d1"><div class="ttname"><a href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4a02322edd4ce56f5e7e278a3b230062d1">WAKE_UP</a></div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00204">main.c:204</a></div></div>
<div class="ttc" id="ADXL362_8h_html_a40573570150c448c0504097f13b96cea"><div class="ttname"><a href="ADXL362_8h.html#a40573570150c448c0504097f13b96cea">ADXL_ackInterrupt</a></div><div class="ttdeci">void ADXL_ackInterrupt(void)</div><div class="ttdoc">Acknowledge the interrupt from the accelerometer. </div><div class="ttdef"><b>Definition:</b> <a href="ADXL362_8c_source.html#l00140">ADXL362.c:140</a></div></div>
<div class="ttc" id="other_8h_html_a843e3c23f8c14dfd5fd52aeacd70f291"><div class="ttname"><a href="other_8h.html#a843e3c23f8c14dfd5fd52aeacd70f291">initVBAT</a></div><div class="ttdeci">void initVBAT(void)</div><div class="ttdoc">Method to initialize the ADC to check the battery voltage. </div><div class="ttdef"><b>Definition:</b> <a href="other_8c_source.html#l00041">other.c:41</a></div></div>
<div class="ttc" id="DS18B20_8h_html_a4067fdb03437426a25af1f210622217b"><div class="ttname"><a href="DS18B20_8h.html#a4067fdb03437426a25af1f210622217b">readTempDS18B20</a></div><div class="ttdeci">float readTempDS18B20(void)</div><div class="ttdoc">Get a temperature value from the DS18B20. </div><div class="ttdef"><b>Definition:</b> <a href="DS18B20_8c_source.html#l00067">DS18B20.c:67</a></div></div>
<div class="ttc" id="interrupt_8h_html_a7e35708d61d26e9fe559a5545cdad810"><div class="ttname"><a href="interrupt_8h.html#a7e35708d61d26e9fe559a5545cdad810">initGPIOwakeup</a></div><div class="ttdeci">void initGPIOwakeup(void)</div><div class="ttdoc">Initialize GPIO wake-up functionality. </div><div class="ttdef"><b>Definition:</b> <a href="interrupt_8c_source.html#l00059">interrupt.c:59</a></div></div>
<div class="ttc" id="main_8c_html_a68d90e0eaaa236e9664bbfc691bbd4d4a0cb1b2c6a7db1f1084886c98909a3f36"><div class="ttname"><a href="main_8c.html#a68d90e0eaaa236e9664bbfc691bbd4d4a0cb1b2c6a7db1f1084886c98909a3f36">INIT</a></div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00201">main.c:201</a></div></div>
<div class="ttc" id="delay_8h_html_adb46f4276f5ddf111153701858f85df6"><div class="ttname"><a href="delay_8h.html#adb46f4276f5ddf111153701858f85df6">delay</a></div><div class="ttdeci">void delay(uint32_t msDelay)</div><div class="ttdoc">Wait for a certain amount of milliseconds. </div><div class="ttdef"><b>Definition:</b> <a href="delay_8c_source.html#l00065">delay.c:65</a></div></div>
<div class="ttc" id="ADXL362_8h_html_a11979b369ae160fe0f1b703766ad30de"><div class="ttname"><a href="ADXL362_8h.html#a11979b369ae160fe0f1b703766ad30de">ADXL_configODR</a></div><div class="ttdeci">void ADXL_configODR(uint8_t givenODR)</div><div class="ttdoc">Configure the Output Data Rate (ODR). </div><div class="ttdef"><b>Definition:</b> <a href="ADXL362_8c_source.html#l00316">ADXL362.c:316</a></div></div>
<div class="ttc" id="ADXL362_8h_html_a94fe350d1a382c347c5aec424d573af8"><div class="ttname"><a href="ADXL362_8h.html#a94fe350d1a382c347c5aec424d573af8">ADXL_configActivity</a></div><div class="ttdeci">void ADXL_configActivity(uint8_t gThreshold)</div><div class="ttdoc">Configure the accelerometer to work in activity threshold mode. </div><div class="ttdef"><b>Definition:</b> <a href="ADXL362_8c_source.html#l00364">ADXL362.c:364</a></div></div>
<div class="ttc" id="main_8c_html_ae1c1201a004beb35d405fd396f53f86c"><div class="ttname"><a href="main_8c.html#ae1c1201a004beb35d405fd396f53f86c">WAKE_UP_PERIOD_S</a></div><div class="ttdeci">#define WAKE_UP_PERIOD_S</div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00195">main.c:195</a></div></div>
<div class="ttc" id="delay_8h_html_aae86f940455b5957441f4331cdc0828d"><div class="ttname"><a href="delay_8h.html#aae86f940455b5957441f4331cdc0828d">sleep</a></div><div class="ttdeci">void sleep(uint32_t sSleep)</div><div class="ttdoc">Sleep for a certain amount of seconds in EM2/3. </div><div class="ttdef"><b>Definition:</b> <a href="delay_8c_source.html#l00168">delay.c:168</a></div></div>
<div class="ttc" id="util_8h_html_ae4f2649524bfb723543f0dc939cd0ddd"><div class="ttname"><a href="util_8h.html#ae4f2649524bfb723543f0dc939cd0ddd">led</a></div><div class="ttdeci">void led(bool enabled)</div><div class="ttdoc">Enable or disable the LED. </div><div class="ttdef"><b>Definition:</b> <a href="util_8c_source.html#l00060">util.c:60</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a99665523a55922c9740992dd62c5912a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99665523a55922c9740992dd62c5912a">&#9670;&nbsp;</a></span>MCUstate</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">volatile <a class="el" href="main_8c.html#aaaac3cd1355a2985b6f312f60d5919ab">MCU_State_t</a> MCUstate</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Keep the state of the state machine </p>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00210">210</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_c6fe9a14e775b8c75819cd4ae39c6ec2.html">SLSTK3400A_project2</a></li><li class="navelem"><a class="el" href="dir_7a60880b611f850b1232fda04488b1a4.html">src</a></li><li class="navelem"><a class="el" href="main_8c.html">main.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
