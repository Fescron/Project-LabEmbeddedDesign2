<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Embedded System Design 2 - Project: Important documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Embedded System Design 2 - Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Important documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In the following sections you can find some important warnings, notes and overall documentation gathered during the creation of this project. This includes, for example, info about settings done with <code>#define</code> statements or certain things found out during debugging. <em>Please read them!</em></p>
<hr/>
<h1><a class="anchor" id="Doxygen"></a>
Doxygen</h1>
<p>This C-project has been made with <a href="www.doxygen.org"><b>Doxygen</b></a> comments above all methods to generate documentation. A combination of <b>Doxygen-specific tags</b> (preceded with an <code>@</code> symbol) and <b>markdown syntax</b> are supported to generate, for example, HTML-files.</p>
<hr/>
<h1><a class="anchor" id="SETTINGS"></a>
Settings using definitions in dbprint and delay functionality</h1>
<p>In the file <code><a class="el" href="debugging_8h.html" title="Enable or disable printing to UART. ">debugging.h</a></code> <b>dbprint UART functionality can be enabled/disabled</b> with the definition <code>#define DEBUGGING</code>. If it's value is <code>0</code>, all dbprint statements are disabled throughout the source code because they're all surrounded with <code>#if DEBUGGING == 1 ... #endif</code> checks.</p>
<p>In the file <code><a class="el" href="delay_8h.html" title="Delay functionality. ">delay.h</a></code> one can <b>choose between SysTicks or RTC sleep functionality</b> for delays. This can be selected with the definition <code>#define SYSTICKDELAY</code>. If it's value is <code>0</code>, the RTC compare sleep functionality is used. if it's value is <code>1</code>, delays are generated using SysTicks.</p>
<p>In the file <code><a class="el" href="delay_8h.html" title="Delay functionality. ">delay.h</a></code> one can also <b>choose between the use of the ultra low-frequency RC oscillator (ULFRCO) or the low-frequency crystal oscillator (LFXO)</b> when being in a delay or sleeping. If the ULFRCO is selected, the MCU sleeps in EM3 and if the LFXO is selected the MCU sleeps in EM2. This can be selected with the definition <code>#define ULFRCO</code>. If it's value is <code>0</code>, the LFXO is used as the clock source. If it's value is <code>1</code> the ULFRCO is used.</p>
<dl class="section note"><dt>Note</dt><dd>Check the section <a class="el" href="index.html#CLOCKS1">Crystals and RC oscillators</a> for more info about this.</dd></dl>
<hr/>
<h1><a class="anchor" id="Initializations"></a>
Initializations</h1>
<dl class="section warning"><dt>Warning</dt><dd>Initializations for the methods <code><a class="el" href="util_8c.html#ae4f2649524bfb723543f0dc939cd0ddd" title="Enable or disable the LED. ">led(bool enabled)</a></code>, <code><a class="el" href="delay_8c.html#adb46f4276f5ddf111153701858f85df6" title="Wait for a certain amount of milliseconds in EM2/3. ">delay(uint32_t msDelay)</a></code> and <code><a class="el" href="delay_8c.html#aae86f940455b5957441f4331cdc0828d" title="Sleep for a certain amount of seconds in EM2/3. ">sleep(uint32_t sSleep)</a></code> happen automatically. This is why their first call sometimes takes longer to finish than later ones.</dd></dl>
<hr/>
<h1><a class="anchor" id="DEBUG"></a>
Debug mode, Energy monitor and VCOM</h1>
<dl class="section warning"><dt>Warning</dt><dd>When in debug mode, the MCU will not go below EM1. This can cause some weird behavior. Exit debug mode and reset the MCU after flashing it for it to go in the correct sleep modes and consume the "expected" power. The Energy profiler can also be used to program the MCU but it's also necessary to reset the MCU after flashing it.</dd></dl>
<p>The Energy profiler in Simplicity Studio seems to use VCOM (on-board UART to USB converter) somehow, change to using an external UART adapter if both the energy profiler and UART debugging are necessary at the same time!</p>
<p>If the energy profiler was used and the code functionality was switched, physically re-plug the board to make sure VCOM UART starts working again!</p>
<hr/>
<h1><a class="anchor" id="CLOCKS1"></a>
Crystals and RC oscillators (delay.c)</h1>
<p>Normally using an external oscillator/crystal uses less energy than the internal one. This external oscillator/crystal can however be omitted if the design goal is to reduce the BOM count as much as possible.</p>
<p>In the delay logic, it's possible to select the use of the ultra low-frequency RC oscillator (ULFRCO) or the low-frequency crystal oscillator (LFXO) when being in a delay or sleeping. If the ULFRCO is selected, the MCU sleeps in EM3 and if the LFXO is selected the MCU sleeps in EM2.</p>
<dl class="section warning"><dt>Warning</dt><dd>After testing it was noted that the ULFRCO uses less power than the LFXO but was less precise for the wake-up times. Take not of this when selecting the necessary logic!</dd></dl>
<p>For the development of the code for the RN2483 shield from DRAMCO, it's possible they chose to use the LFXO instead of the ULFRCO in sleep because the crystal was more stable for high baudrate communication using the LEUART peripheral.</p>
<dl class="section note"><dt>Note</dt><dd>For low-power development it's advised to consistently enable peripherals and oscillators/clocks when needed and disable them afterwards. For some methods it can be useful to provide a boolean argument so that in the case of sending more bytes the clock can be disabled only after sending the latest one. Perhaps this can be used in combination with static variables in the method so they keep their value between calls and recursion can be used.</dd></dl>
<hr/>
<h1><a class="anchor" id="cmuClock_GPIO"></a>
cmuClock_GPIO</h1>
<p>At one point in the development phase the clock to the GPIO peripheral was always enabled when necessary and disabled afterwards. Because the GPIO clock needs to be enabled for almost everything, even during EM2 so the MCU can react (and not only log) pin interrupts, this behavior was later scrapped.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd><ul>
<li>Also talk about cmuClock_HFPER?</li>
</ul>
</dd></dl>
<hr/>
<h1><a class="anchor" id="RTCC"></a>
RTCC (RTC calendar)</h1>
<p>At another point in the development phase there was looked into using the RTCC (RTC calendar) to wake up the MCU every hour. This peripheral can run down to EM4H when using LFRCO, LFXO or ULFRCO. Unfortunately the Happy Gecko doesn't have this functionality so it can't be implemented in this case.</p>
<hr/>
<h1><a class="anchor" id="EM"></a>
Energy modes (EM1 and EM3)</h1>
<p>At one point a method was developed to go in EM1 when waiting in a delay. This however didn't seem to work as intended and EM2 would also be fine. Because of this, development for this EM1 delay method was halted. EM1 is sometimes used when waiting on bits to be set.</p>
<p>When the MCU is in EM1, the clock to the CPU is disabled. All peripherals, as well as RAM and flash, are available.</p>
<p>In EM3, high and low frequency clocks are disabled. No oscillator (except the ULFRCO) is running. Furthermore, all unwanted oscillators are disabled in EM3. This means that nothing needs to be manually disabled before the statement <code>EMU_EnterEM3(true);</code>.</p>
<p>The following modules/functions are are generally still available in EM3: </p><ul>
<li>I2C address check </li>
<li>Watchdog </li>
<li>Asynchronous pin interrupt </li>
<li>Analog comparator (ACMP) </li>
<li>Voltage comparator (VCMP)</li>
</ul>
<hr/>
<h1><a class="anchor" id="UART"></a>
Alternate UART Functionality Pinout</h1>
<table class="doxtable">
<tr>
<th>Location </th><th><code>#0</code> </th><th><code>#1</code> </th><th><code>#2</code> </th><th><code>#3</code> </th><th><code>#4</code> </th><th><code>#5</code> </th><th><code>#6</code>  </th></tr>
<tr>
<td><code>US0_RX</code> </td><td><code>PE11</code> </td><td></td><td><code>PC10</code> </td><td><code>PE12</code> </td><td><code>PB08</code> </td><td><code>PC01</code> </td><td><code>PC01</code> </td></tr>
<tr>
<td><code>US0_TX</code> </td><td><code>PE10</code> </td><td></td><td></td><td><code>PE13</code> </td><td><code>PB07</code> </td><td><code>PC00</code> </td><td><code>PC00</code> </td></tr>
<tr>
<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr>
<td><code>US1_RX</code> </td><td><code>PC01</code> </td><td></td><td><code>PD06</code> </td><td><code>PD06</code> </td><td><code>PA00</code> </td><td><code>PC02</code> </td><td></td></tr>
<tr>
<td><code>US1_TX</code> </td><td><code>PC00</code> </td><td></td><td><code>PD07</code> </td><td><code>PD07</code> </td><td><code>PF02</code> </td><td><code>PC01</code> </td><td></td></tr>
</table>
<p>VCOM:</p><ul>
<li>USART1 #4 (USART0 can't be used)</li>
<li>RX - <code>PA0</code></li>
<li>TX - <code>PF2</code></li>
</ul>
<hr/>
<h1><a class="anchor" id="DBPRINT"></a>
More info about `dbprint`</h1>
<p>When using <code>dbprint</code> functionality, the following settings are used:</p><ul>
<li>Baudrate = 115200</li>
<li>8 databits</li>
<li>1 stopbit</li>
<li>No parity</li>
</ul>
<p>When you want to debug using VCOM with interrupt functionality disabled, you can use the following initialization settings: <code>dbprint_INIT(USART1, 4, true, false);</code></p>
<hr/>
<h1><a class="anchor" id="Keywords"></a>
Keywords</h1>
<h2><a class="anchor" id="Volatile"></a>
Volatile</h2>
<p>The <code>volatile</code> type indicates to the compiler that the data is not normal memory, and could change at unexpected times. Hardware registers are often volatile, and so are variables which get changed in interrupts.</p>
<h2><a class="anchor" id="Extern"></a>
Extern</h2>
<p>Declare the global variables in headers (and use the <code>extern</code> keyword there) and actually define them in the appropriate source file.</p>
<h2><a class="anchor" id="Static"></a>
Static</h2>
<ul>
<li><b>Static variable inside a function:</b> The variable keeps its value between invocations.</li>
<li><b>Static global variable or function:</b> The variable or function is only "seen" in the file it's declared in.</li>
</ul>
<hr/>
<h1><a class="anchor" id="DATA"></a>
Bits, bytes, nibbles and unsigned/signed integer value ranges</h1>
<ul>
<li>1 nibble = 4 bits (<code>0b1111</code> = <code>0xF</code> )</li>
<li>1 byte = 8 bits (<code>0b1111 1111</code> = <code>0xFF</code>)</li>
</ul>
<table class="doxtable">
<tr>
<th>Type </th><th>Alias </th><th>Size </th><th>Minimum value </th><th>Maximum value  </th></tr>
<tr>
<td><code>uint8_t</code> </td><td><code>unsigned char</code> </td><td>1 byte </td><td>0 </td><td>255 (<code>0xFF</code>) </td></tr>
<tr>
<td><code>uint16_t</code> </td><td><code>unsigned short</code> </td><td>2 bytes </td><td>0 </td><td>65 535 (<code>0xFFFF</code>) </td></tr>
<tr>
<td><code>uint32_t</code> </td><td><code>unsigned int</code> </td><td>4 bytes </td><td>0 </td><td>4 294 967 295 (<code>0xFFFF FFFF</code>) </td></tr>
<tr>
<td></td><td></td><td></td><td></td><td></td></tr>
<tr>
<td><code>int8_t</code> </td><td><code>signed char</code> </td><td>1 byte </td><td>-128 </td><td>127 </td></tr>
<tr>
<td><code>int16_t</code> </td><td><code>signed short</code> </td><td>2 bytes </td><td>-32 768 </td><td>32 767 </td></tr>
<tr>
<td><code>int32_t</code> </td><td><code>signed int</code> </td><td>4 bytes </td><td>-2 147 483 648 </td><td>2 147 483 647 </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun Apr 21 2019 15:53:25 for Embedded System Design 2 - Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
